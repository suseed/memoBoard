<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Sticky Notes Board</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html,body{margin:0;padding:0;height:100%;font-family:Arial,sans-serif}
    body{display:flex;flex-direction:column;background:#f4f4f4}
    #toolbar{display:flex;gap:8px;padding:10px;background:#333;color:#fff;align-items:center}
    #toolbar button{padding:6px 12px;border:none;border-radius:4px;cursor:pointer;font-weight:600}
    #toolbar button:hover{opacity:.8}
    #board{flex:1;position:relative;overflow:auto}
    .note{position:absolute;width:200px;min-height:120px;padding:10px;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,.15);cursor:move;user-select:none;display:flex;flex-direction:column;gap:6px}
    .note header{display:flex;justify-content:space-between;align-items:center}
    .note header button{background:none;border:none;font-size:16px;cursor:pointer;font-weight:bold;line-height:1}
    .note header button:hover{opacity:.75}
    .note textarea{flex:1;border:none;resize:none;background:transparent;font-size:14px;font-family:inherit;line-height:1.4;outline:none}
  </style>
</head>
<body>
  <div id="toolbar">
    <button id="addBtn">+ 새 메모</button>
    <button id="saveBtn">💾 저장</button>
    <button id="loadBtn">📂 불러오기</button>
    <input type="file" id="fileInput" accept="application/json" style="display:none" />
  </div>
  <div id="board"></div>

  <script>
    const board = document.getElementById('board');
    const addBtn  = document.getElementById('addBtn');
    const saveBtn = document.getElementById('saveBtn');
    const loadBtn = document.getElementById('loadBtn');
    const fileInput = document.getElementById('fileInput');

    const colors = ['#fff9b1','#ffd6a5','#caffbf','#a0c4ff','#ffc6ff','#fffffc','#ffadad'];
    let z = 1;

    addBtn.addEventListener('click', () => createNote({text:'',x:40,y:40,color:colors[0]}));

    saveBtn.addEventListener('click', saveNotes);
    loadBtn.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', handleFileLoad);

    function createNote({text,x,y,color}){
      const note = document.createElement('div');
      note.className = 'note';
      note.style.background = color;
      note.style.left = x + 'px';
      note.style.top  = y + 'px';
      note.style.zIndex = ++z;

      note.innerHTML = `<header>
          <button class="colorBtn">🎨</button>
          <button class="delBtn">×</button>
        </header>
        <textarea placeholder="내용...">${text}</textarea>`;

      board.appendChild(note);
      makeDraggable(note);

      note.querySelector('.colorBtn').addEventListener('click', () => {
        const current = colors.indexOf(note.style.background);
        note.style.background = colors[(current+1)%colors.length];
      });

      note.querySelector('.delBtn').addEventListener('click', () => note.remove());
    }

    function makeDraggable(el){
      let offsetX, offsetY, isDown = false;
      el.addEventListener('mousedown', (e) => {
        if(e.target.tagName.toLowerCase() === 'textarea') return; // allow text selection
        isDown = true;
        el.style.zIndex = ++z;
        offsetX = e.clientX - el.offsetLeft;
        offsetY = e.clientY - el.offsetTop;
      });
      document.addEventListener('mousemove', (e) => {
        if(!isDown) return;
        el.style.left = (e.clientX - offsetX) + 'px';
        el.style.top  = (e.clientY - offsetY) + 'px';
      });
      document.addEventListener('mouseup', () => {isDown=false;});
    }

    function saveNotes(){
      const notes = [...document.querySelectorAll('.note')].map(n => ({
        text: n.querySelector('textarea').value,
        x:   parseInt(n.style.left),
        y:   parseInt(n.style.top),
        color: n.style.background
      }));
      const blob = new Blob([JSON.stringify(notes,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'notes.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    function handleFileLoad(){
      const file = fileInput.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        try{
          const data = JSON.parse(e.target.result);
          if(!Array.isArray(data)) throw new Error('Invalid format');
          board.innerHTML = '';
          data.forEach(obj => createNote(obj));
        }catch(err){
          alert('로드 실패: 올바른 JSON이 아닙니다');
        }
      };
      reader.readAsText(file, 'utf-8');
      fileInput.value = '';
    }
  </script>
</body>
</html>
